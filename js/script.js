$("document").ready((function(){function e(){$(window).width()<992?$(".header .contacts__phone").appendTo(".header-left"):$(window).width()>992&&$(".header .contacts__phone").prependTo(".header__contacts")}$(window).resize((function(){e()})),e()}));const triggered_select=$(".block, .card__btn");let triggered_blocks=localStorage.getItem("triggered_blocks")?JSON.parse(localStorage.getItem("triggered_blocks")):[];function initBlocks(e){e.filter((function(e,t){if(-1!=triggered_blocks.indexOf($(t).data("slide")))return t})).each((function(){$(this).addClass("active"),$(this).find(".block__icon img").attr("src",$(this).find(".block__icon img").attr("src").replace(/\./g,"_active."))})),e.filter((function(e,t){if(-1==triggered_blocks.indexOf($(t).data("slide")))return t})).each((function(){$(this).removeClass("active"),$(this).find(".block__icon img").attr("src",$(this).find(".block__icon img").attr("src").replace(/_active/g,""))}));$(".submit-application-select__title > span").text($(".block.active").length)}triggered_select.click((function(){let e=$(this),t=e.data("slide");if(-1==$.inArray(t,triggered_blocks))triggered_blocks.push(t);else{if(0==e.hasClass("block"))return;triggered_blocks=$.grep(triggered_blocks,(function(e){return e!=t}))}localStorage.setItem("triggered_blocks",JSON.stringify(triggered_blocks)),initBlocks($(`.block[data-slide="${t}"]`))})),initBlocks($(".block")),$(".card").each((function(){let e=$(this).find(".gallery__image img"),t=e[Math.floor(Math.random()*e.length)].src;$(this).css("background-image",`url("${t}")`)}));let images=$(".gallery__image");function progressBar(){$(window).scrollTop(),$(window).height();let e=$(window).height(),t=$(document).height()-e,i=$(window).scrollTop()/t*100,o=$(".header__cover").height()/t*100;if(i<o){let e=(100-o+o-2*i)/100;if(e>.85)return;$(".header__cover").css("opacity",e)}}function throttle(e,t,i){let o=localStorage.getItem(`time-${i}`)?localStorage.getItem(`time-${i}`):void 0;return function(...s){null==o&&(o=$.now(),localStorage.setItem(`time-${i}`,o),e(...s)),$.now()-o>t?(o=$.now(),localStorage.setItem(`time-${i}`,o),e(...s)):getAlert_error(`Подождите еще ${(t/1e3-($.now()-o)/1e3).toFixed(0)} секунд!`)}}function getAlert_succ(e){Swal.fire({position:"top-end",icon:"success",title:e,padding:"2em",width:"100%",color:"#232122",background:"#EAEAEA",showConfirmButton:!1,timer:3500,toast:!0})}function getAlert_error(e){Swal.fire({position:"top-end",icon:"error",title:e,padding:"2em",width:"100%",color:"red",background:"#EAEAEA",showConfirmButton:!1,timer:3500,toast:!0})}images.mouseover((function(){let e=$(this),t=$(this).find("img").attr("src");e.parents(".card").css("background-image",`url("${t}")`)})),$("[data-fancybox]").fancybox({}),$(window).scroll(progressBar),$('a[href^="#"]').on("click",(function(e){e.preventDefault();var t,i=$(this.hash);i.length&&(t=$(window).width()<768?120:220,$("html, body").animate({scrollTop:i.offset().top-t},400))})),$(window).on("touchmove",(function(){$('a[href^="#"]').data("clicked",!1)})),$(document).on("touchend",'a[href^="#"]',(function(e){$(this).data("clicked")&&(e.preventDefault(),$(this).data("clicked",!1))}));const sticky=$(".carousel-services-dots"),stickyTopDefault=sticky.offset().top;let cards_pos=[];function get_posCards(){$(".card").each((function(){cards_pos.push({card:$(this),pos:$(this).offset().top})}))}get_posCards(),$(window).resize(get_posCards),$(window).scroll((function(){let e=$(document).scrollTop(),t=sticky.offset().top;e>=stickyTopDefault&&($(".carousel-services-dots").addClass("fixed"),$(cards_pos).each((function(){if($(this)[0].pos<t){var e=$(this)[0].card.css("background-image");e=e.replace("url(","").replace(")","").replace(/\"/gi,"");var i=$(this)[0].card.data("slide");sticky.css("background-image",`url(${e})`),$(`.carousel-services-dot[data-slide='${i}']`).addClass("active")}}))),e<stickyTopDefault&&($(".carousel-services-dots").removeClass("fixed"),sticky.css("background-image",""))}));let owl_servcies=$(".owl-carousel--services").owlCarousel({slideSpeed:300,paginationSpeed:400,center:!0,stopOnHover:!0,autoplay:100,loop:!0,margin:50});$(".carousel-services-dot").click((function(){owl_servcies.trigger("to.owl.carousel",[$(this).index(),300])})),$(".carousel-services__next").click((function(){owl_servcies.trigger("next.owl.carousel",[300])})),$(".carousel-services__prev").click((function(){owl_servcies.trigger("prev.owl.carousel",[300])})),$(".carousel-services-dot").click((function(e,t){$(".carousel-services-dots").hasClass("fixed")&&$("html, body").animate({scrollTop:$(`.card__btn[data-slide='${$(this).data("slide")}']`).parents(".card").offset().top},1e3)})),$(".card__btn").click((function(e){$(this).siblings(".card__title").text();$.fancybox.open({src:".submit-application",type:"inline",autoSize:!0})})),$(".submit-application-form").validate({rules:{phone:{required:!0},name:{required:!0}},messages:{phone:{required:"Введите номер телефона!"},name:{required:"Введите имя!"}},submitHandler:function(e){throttle((function(){let e=[];$(".block.active .block__title").each((function(){e.push($(this).text())})),$.ajax({url:"/php/submit-application.php",type:"post",data:{phone:$('.submit-application-form input[name="phone"]').val(),name:$('.submit-application-form input[name="name"]').val(),review:$('.submit-application-form textarea[name="review"').val(),selected:JSON.stringify(e)},success:function(e){getAlert_succ("Заявка успешно отправлена! Ожидайте ответа!")}})}),18e4,"submit-application")()}}),$.validator.addMethod("phone",(function(e,t){return this.optional(t)||/^\+?\d{1,4}?[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/.test(e)}),"Номер введен некорректно!");
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkYXB0aXZlLmpzIiwic2VsZWN0ZWRCbG9ja3MuanMiLCJjYXJkcy5qcyIsImhlYWRlcl9ib3R0b20uanMiLCJoZWxwZWQuanMiLCJmYW5jeS1ib3guanMiLCJuYXZpZ2F0aW9uLmpzIiwib3dsLWNhcm91c2VsLmpzIiwic3VibWl0LWFwcGxpY2F0aW9uLmpzIl0sIm5hbWVzIjpbIiQiLCJyZWFkeSIsImFkYXB0aXZlIiwid2luZG93Iiwid2lkdGgiLCJhcHBlbmRUbyIsInByZXBlbmRUbyIsInJlc2l6ZSIsInRyaWdnZXJlZF9zZWxlY3QiLCJ0cmlnZ2VyZWRfYmxvY2tzIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIkpTT04iLCJwYXJzZSIsImluaXRCbG9ja3MiLCJkYXRhIiwiZmlsdGVyIiwiaW5kZXgiLCJpdGVtIiwiaW5kZXhPZiIsImVhY2giLCJ0aGlzIiwiYWRkQ2xhc3MiLCJmaW5kIiwiYXR0ciIsInJlcGxhY2UiLCJyZW1vdmVDbGFzcyIsInRleHQiLCJsZW5ndGgiLCJjbGljayIsInRyaWdnZXIiLCJibG9ja19pbmRleCIsImluQXJyYXkiLCJwdXNoIiwiaGFzQ2xhc3MiLCJncmVwIiwidmFsdWUiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiY2FyZF9faW1hZ2VzIiwiY2FyZF9faW1hZ2UiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzcmMiLCJjc3MiLCJpbWFnZXMiLCJwcm9ncmVzc0JhciIsInNjcm9sbFRvcCIsImhlaWdodCIsIndpbkgiLCJiYXNlWCIsImRvY3VtZW50IiwiYSIsImIiLCJvcGFjaXR5IiwidGhyb3R0bGUiLCJmdW5jIiwic2Vjb25kcyIsIm5hbWUiLCJ0aW1lciIsInVuZGVmaW5lZCIsImFyZ3MiLCJub3ciLCJnZXRBbGVydF9lcnJvciIsInRvRml4ZWQiLCJnZXRBbGVydF9zdWNjIiwiU3dhbCIsImZpcmUiLCJwb3NpdGlvbiIsImljb24iLCJ0aXRsZSIsInBhZGRpbmciLCJjb2xvciIsImJhY2tncm91bmQiLCJzaG93Q29uZmlybUJ1dHRvbiIsInRvYXN0IiwibW91c2VvdmVyIiwidGhpc19pbWFnZSIsInRoaXNfc3JjIiwicGFyZW50cyIsImZhbmN5Ym94Iiwic2Nyb2xsIiwib24iLCJ0IiwicHJldmVudERlZmF1bHQiLCJlIiwibiIsImhhc2giLCJhbmltYXRlIiwib2Zmc2V0IiwidG9wIiwic3RpY2t5Iiwic3RpY2t5VG9wRGVmYXVsdCIsImNhcmRzX3BvcyIsImdldF9wb3NDYXJkcyIsImNhcmQiLCJwb3MiLCJ3aW5kb3dUb3AiLCJzdGlja3lUb3AiLCJjYXJkX2ltYWdlIiwiY2FyZF9pbmRleCIsIm93bF9zZXJ2Y2llcyIsIm93bENhcm91c2VsIiwic2xpZGVTcGVlZCIsInBhZ2luYXRpb25TcGVlZCIsImNlbnRlciIsInN0b3BPbkhvdmVyIiwiYXV0b3BsYXkiLCJsb29wIiwibWFyZ2luIiwiZG90Iiwic2libGluZ3MiLCJvcGVuIiwidHlwZSIsImF1dG9TaXplIiwidmFsaWRhdGUiLCJydWxlcyIsInBob25lIiwicmVxdWlyZWQiLCJtZXNzYWdlcyIsInN1Ym1pdEhhbmRsZXIiLCJmb3JtIiwiYWN0aXZhdGVkX2l0ZW1zIiwiYWpheCIsInVybCIsInZhbCIsInJldmlldyIsInNlbGVjdGVkIiwic3VjY2VzcyIsInZhbGlkYXRvciIsImFkZE1ldGhvZCIsImVsZW1lbnQiLCJvcHRpb25hbCIsInRlc3QiXSwibWFwcGluZ3MiOiJBQUFBQSxFQUFBLFlBQUFDLE9BQUEsV0FDQSxTQUFBQyxJQUNBRixFQUFBRyxRQUFBQyxRQUFBLElBQ0FKLEVBQUEsNEJBQUFLLFNBQUEsZ0JBQ0FMLEVBQUFHLFFBQUFDLFFBQUEsS0FDQUosRUFBQSw0QkFBQU0sVUFBQSxvQkFFQSxDQUVBTixFQUFBRyxRQUFBSSxRQUFBLFdBQ0FMLEdBQ0EsSUFFQUEsR0FDQSxJQ2RBLE1BQUFNLGlCQUFBUixFQUFBLHNCQUNBLElBQUFTLGlCQUFBQyxhQUFBQyxRQUFBLG9CQUFBQyxLQUFBQyxNQUFBSCxhQUFBQyxRQUFBLHFCQUFBLEdB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b3VyY2VzQ29udGVudCI6WyIkKCdkb2N1bWVudCcpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcbiAgICBmdW5jdGlvbiBhZGFwdGl2ZSgpe1xyXG4gICAgICAgIGlmKCQod2luZG93KS53aWR0aCgpIDwgOTkyKXtcclxuICAgICAgICAgICAgJCgnLmhlYWRlciAuY29udGFjdHNfX3Bob25lJykuYXBwZW5kVG8oJy5oZWFkZXItbGVmdCcpO1xyXG4gICAgICAgIH1lbHNlIGlmKCQod2luZG93KS53aWR0aCgpID4gOTkyKXtcclxuICAgICAgICAgICAgJCgnLmhlYWRlciAuY29udGFjdHNfX3Bob25lJykucHJlcGVuZFRvKCcuaGVhZGVyX19jb250YWN0cycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgYWRhcHRpdmUoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFkYXB0aXZlKCk7XHJcbn0pOyIsImNvbnN0IHRyaWdnZXJlZF9zZWxlY3QgPSAkKCcuYmxvY2ssIC5jYXJkX19idG4nKTtcclxubGV0IHRyaWdnZXJlZF9ibG9ja3MgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndHJpZ2dlcmVkX2Jsb2NrcycpID8gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndHJpZ2dlcmVkX2Jsb2NrcycpKSA6W107XHJcblxyXG50cmlnZ2VyZWRfc2VsZWN0LmNsaWNrKGZ1bmN0aW9uKCl7XHJcbiAgICBsZXQgdHJpZ2dlciA9ICQodGhpcyk7XHJcbiAgICBsZXQgYmxvY2tfaW5kZXggPSB0cmlnZ2VyLmRhdGEoJ3NsaWRlJyk7XHJcblxyXG4gICAgaWYoJC5pbkFycmF5KGJsb2NrX2luZGV4LCB0cmlnZ2VyZWRfYmxvY2tzKSA9PSAtMSl7XHJcbiAgICAgICAgdHJpZ2dlcmVkX2Jsb2Nrcy5wdXNoKGJsb2NrX2luZGV4KTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIGlmKHRyaWdnZXIuaGFzQ2xhc3MoJ2Jsb2NrJykgPT0gZmFsc2UpIHJldHVybjtcclxuICAgICAgICB0cmlnZ2VyZWRfYmxvY2tzID0gJC5ncmVwKHRyaWdnZXJlZF9ibG9ja3MsIGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPSBibG9ja19pbmRleDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndHJpZ2dlcmVkX2Jsb2NrcycsIEpTT04uc3RyaW5naWZ5KHRyaWdnZXJlZF9ibG9ja3MpKTtcclxuICAgIGluaXRCbG9ja3MoJChgLmJsb2NrW2RhdGEtc2xpZGU9XCIke2Jsb2NrX2luZGV4fVwiXWApKTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBpbml0QmxvY2tzKGRhdGEpe1xyXG4gICAgbGV0IGhhdmVkX2FyciA9IGRhdGEuZmlsdGVyKGZ1bmN0aW9uKGluZGV4LCBpdGVtKXtcclxuICAgICAgICBpZih0cmlnZ2VyZWRfYmxvY2tzLmluZGV4T2YoJChpdGVtKS5kYXRhKCdzbGlkZScpKSAhPSAtMSl7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgIH1cclxuICAgIH0pLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuXHJcbiAgICAgICAgJCh0aGlzKS5maW5kKCcuYmxvY2tfX2ljb24gaW1nJykuYXR0cignc3JjJywgJCh0aGlzKS5maW5kKCcuYmxvY2tfX2ljb24gaW1nJykuYXR0cignc3JjJykucmVwbGFjZSgvXFwuL2csJ19hY3RpdmUuJykpO1xyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIGxldCBjbGVhcl9hcnIgPSBkYXRhLmZpbHRlcihmdW5jdGlvbihpbmRleCwgaXRlbSl7XHJcbiAgICAgICAgaWYodHJpZ2dlcmVkX2Jsb2Nrcy5pbmRleE9mKCQoaXRlbSkuZGF0YSgnc2xpZGUnKSkgPT0gLTEpe1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICB9XHJcbiAgICB9KS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgJCh0aGlzKS5maW5kKCcuYmxvY2tfX2ljb24gaW1nJykuYXR0cignc3JjJywgJCh0aGlzKS5maW5kKCcuYmxvY2tfX2ljb24gaW1nJykuYXR0cignc3JjJykucmVwbGFjZSgvX2FjdGl2ZS9nLCAnJykpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLnN1Ym1pdC1hcHBsaWNhdGlvbi1zZWxlY3RfX3RpdGxlID4gc3BhbicpLnRleHQoJCgnLmJsb2NrLmFjdGl2ZScpLmxlbmd0aCk7XHJcbn1cclxuXHJcblxyXG5cclxuaW5pdEJsb2NrcygkKCcuYmxvY2snKSk7IiwiXHJcbiQoJy5jYXJkJykuZWFjaChmdW5jdGlvbigpe1xyXG4gIGxldCBjYXJkX19pbWFnZXMgPSAkKHRoaXMpLmZpbmQoJy5nYWxsZXJ5X19pbWFnZSBpbWcnKTtcclxuICBsZXQgY2FyZF9faW1hZ2UgPSBjYXJkX19pbWFnZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmNhcmRfX2ltYWdlcy5sZW5ndGgpXS5zcmM7XHJcbiAgJCh0aGlzKS5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnLCBgdXJsKFwiJHtjYXJkX19pbWFnZX1cIilgKTtcclxufSk7XHJcblxyXG5sZXQgaW1hZ2VzID0gJCgnLmdhbGxlcnlfX2ltYWdlJyk7XHJcblxyXG5pbWFnZXMubW91c2VvdmVyKGZ1bmN0aW9uKCl7XHJcbiAgbGV0IHRoaXNfaW1hZ2UgPSAkKHRoaXMpO1xyXG4gIGxldCB0aGlzX3NyYyA9ICQodGhpcykuZmluZCgnaW1nJykuYXR0cignc3JjJyk7XHJcbiAgXHJcbiAgdGhpc19pbWFnZS5wYXJlbnRzKCcuY2FyZCcpLmNzcygnYmFja2dyb3VuZC1pbWFnZScsIGB1cmwoXCIke3RoaXNfc3JjfVwiKWApO1xyXG59KTtcclxuIiwiZnVuY3Rpb24gcHJvZ3Jlc3NCYXIoKSB7XHJcbiAgICBsZXQgc2Nyb2xsUG9zID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG4gICAgbGV0IFdpbmRvd0hlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTtcclxuXHJcblxyXG4gICAgbGV0IHdpbkggPSAkKHdpbmRvdykuaGVpZ2h0KCk7XHJcbiAgICBsZXQgZG9jSCA9ICQoZG9jdW1lbnQpLmhlaWdodCgpO1xyXG5cclxuXHJcblxyXG4gICAgbGV0IGJhc2VYID0gZG9jSCAtIHdpbkg7XHJcblxyXG4gICAgbGV0IGEgPSAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpIC8gYmFzZVgpICogMTAwO1xyXG4gICAgbGV0IGIgPSAoJCgnLmhlYWRlcl9fY292ZXInKS5oZWlnaHQoKSAvIGJhc2VYKSAqIDEwMDtcclxuXHJcbiAgICBpZihhIDwgYil7XHJcbiAgICAgICAgbGV0IHNwZWVkID0gYSAqIDI7XHJcbiAgICAgICAgbGV0IG9mZnNldCA9ICgxMDAgLSBiKSArIGI7XHJcbiAgICAgICAgbGV0IG9wYWNpdHkgPSAob2Zmc2V0IC0gc3BlZWQpIC8gMTAwO1xyXG5cclxuXHJcbiAgICAgICAgaWYob3BhY2l0eSA+IDAuODUpIHJldHVybjtcclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAkKCcuaGVhZGVyX19jb3ZlcicpLmNzcygnb3BhY2l0eScsIG9wYWNpdHkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG5cclxuXHJcbiQod2luZG93KS5zY3JvbGwocHJvZ3Jlc3NCYXIpOyIsImZ1bmN0aW9uIHRocm90dGxlKGZ1bmMsIHNlY29uZHMsIG5hbWUpe1xyXG4gICAgbGV0IHRpbWVyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRpbWUtJHtuYW1lfWApID8gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRpbWUtJHtuYW1lfWApIDogdW5kZWZpbmVkO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKC4uLmFyZ3Mpe1xyXG4gICAgICAgIGlmKHRpbWVyID09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgIHRpbWVyID0gJC5ub3coKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRpbWUtJHtuYW1lfWAsIHRpbWVyKTtcclxuICAgICAgICAgICAgZnVuYyguLi5hcmdzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoJC5ub3coKSAtIHRpbWVyID4gc2Vjb25kcyl7XHJcbiAgICAgICAgICAgIHRpbWVyID0gJC5ub3coKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRpbWUtJHtuYW1lfWAsIHRpbWVyKTtcclxuICAgICAgICAgICAgZnVuYyguLi5hcmdzKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZ2V0QWxlcnRfZXJyb3IoYNCf0L7QtNC+0LbQtNC40YLQtSDQtdGJ0LUgJHsoc2Vjb25kcyAvIDEwMDAgLSAoJC5ub3coKSAtIHRpbWVyKSAvIDEwMDApLnRvRml4ZWQoMCl9INGB0LXQutGD0L3QtCFgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBnZXRBbGVydF9zdWNjKHRleHQpe1xyXG4gICAgU3dhbC5maXJlKHtcclxuICAgICAgICBwb3NpdGlvbjogJ3RvcC1lbmQnLFxyXG4gICAgICAgIGljb246ICdzdWNjZXNzJyxcclxuICAgICAgICB0aXRsZTogdGV4dCxcclxuICAgICAgICBwYWRkaW5nOiAnMmVtJyxcclxuXHJcbiAgICAgICAgd2lkdGg6ICcxMDAlJyxcclxuICAgICAgICBjb2xvcjogJyMyMzIxMjInLFxyXG4gICAgICAgIGJhY2tncm91bmQ6ICcjRUFFQUVBJyxcclxuXHJcbiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLFxyXG4gICAgICAgIHRpbWVyOiAzNTAwLFxyXG5cclxuICAgICAgICB0b2FzdDogdHJ1ZSxcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEFsZXJ0X2Vycm9yKHRleHQpe1xyXG4gIFN3YWwuZmlyZSh7XHJcbiAgICAgIHBvc2l0aW9uOiAndG9wLWVuZCcsXHJcbiAgICAgIGljb246ICdlcnJvcicsXHJcbiAgICAgIHRpdGxlOiB0ZXh0LFxyXG4gICAgICBwYWRkaW5nOiAnMmVtJyxcclxuXHJcbiAgICAgIHdpZHRoOiAnMTAwJScsXHJcbiAgICAgIGNvbG9yOiAncmVkJyxcclxuICAgICAgYmFja2dyb3VuZDogJyNFQUVBRUEnLFxyXG5cclxuICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLFxyXG4gICAgICB0aW1lcjogMzUwMCxcclxuXHJcbiAgICAgIHRvYXN0OiB0cnVlLFxyXG4gIH0pXHJcbn1cclxuXHJcblxyXG4kKCdhW2hyZWZePVwiI1wiXScpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24odCkge1xyXG4gICAgdC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdmFyIGUsIG4gPSAkKHRoaXMuaGFzaCk7XHJcbiAgICBuLmxlbmd0aCAmJiAoZSA9ICQod2luZG93KS53aWR0aCgpIDwgNzY4ID8gMTIwIDogMjIwLCAkKFwiaHRtbCwgYm9keVwiKS5hbmltYXRlKHtcclxuICAgICAgICBzY3JvbGxUb3A6IG4ub2Zmc2V0KCkudG9wIC0gZVxyXG4gICAgfSwgNDAwKSlcclxufSksICQod2luZG93KS5vbihcInRvdWNobW92ZVwiLCBmdW5jdGlvbigpIHtcclxuICAgICQoJ2FbaHJlZl49XCIjXCJdJykuZGF0YShcImNsaWNrZWRcIiwgITEpXHJcbn0pLCAkKGRvY3VtZW50KS5vbihcInRvdWNoZW5kXCIsICdhW2hyZWZePVwiI1wiXScsIGZ1bmN0aW9uKHQpIHtcclxuICAgICQodGhpcykuZGF0YShcImNsaWNrZWRcIikgJiYgKHQucHJldmVudERlZmF1bHQoKSwgJCh0aGlzKS5kYXRhKFwiY2xpY2tlZFwiLCAhMSkpXHJcbn0pIiwiJChcIltkYXRhLWZhbmN5Ym94XVwiKS5mYW5jeWJveCh7XHJcbn0pOyIsIlxyXG5jb25zdCBzdGlja3kgPSAkKCcuY2Fyb3VzZWwtc2VydmljZXMtZG90cycpO1xyXG5jb25zdCBzdGlja3lUb3BEZWZhdWx0ID0gc3RpY2t5Lm9mZnNldCgpLnRvcDtcclxubGV0IGNhcmRzX3BvcyA9IFtdO1xyXG5cclxuZnVuY3Rpb24gZ2V0X3Bvc0NhcmRzKCl7XHJcbiAgJCgnLmNhcmQnKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICBjYXJkc19wb3MucHVzaCh7Y2FyZDogJCh0aGlzKSwgcG9zOiAkKHRoaXMpLm9mZnNldCgpLnRvcH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5nZXRfcG9zQ2FyZHMoKVxyXG4kKHdpbmRvdykucmVzaXplKGdldF9wb3NDYXJkcyk7XHJcblxyXG5cclxuJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpe1xyXG4gIGxldCB3aW5kb3dUb3AgPSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKTtcclxuICBsZXQgc3RpY2t5VG9wID0gc3RpY2t5Lm9mZnNldCgpLnRvcDtcclxuXHJcbiAgaWYod2luZG93VG9wID49IHN0aWNreVRvcERlZmF1bHQpe1xyXG4gICAgJCgnLmNhcm91c2VsLXNlcnZpY2VzLWRvdHMnKS5hZGRDbGFzcygnZml4ZWQnKTtcclxuXHJcblxyXG4gICAgJChjYXJkc19wb3MpLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgaWYoJCh0aGlzKVswXS5wb3MgPCBzdGlja3lUb3Ape1xyXG4gICAgICAgIHZhciBjYXJkX2ltYWdlICA9ICQodGhpcylbMF0uY2FyZC5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnKTtcclxuICAgICAgICBjYXJkX2ltYWdlID0gY2FyZF9pbWFnZS5yZXBsYWNlKCd1cmwoJywnJykucmVwbGFjZSgnKScsJycpLnJlcGxhY2UoL1xcXCIvZ2ksIFwiXCIpO1xyXG5cclxuICAgICAgICB2YXIgY2FyZF9pbmRleCA9ICQodGhpcylbMF0uY2FyZC5kYXRhKCdzbGlkZScpO1xyXG4gICAgICAgIHN0aWNreS5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnLCBgdXJsKCR7Y2FyZF9pbWFnZX0pYCk7XHJcblxyXG4gICAgICAgICQoYC5jYXJvdXNlbC1zZXJ2aWNlcy1kb3RbZGF0YS1zbGlkZT0nJHtjYXJkX2luZGV4fSddYCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG4gIFxyXG4gIGlmKHdpbmRvd1RvcCA8IHN0aWNreVRvcERlZmF1bHQpe1xyXG4gICAgJCgnLmNhcm91c2VsLXNlcnZpY2VzLWRvdHMnKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcclxuICAgIHN0aWNreS5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnLCAnJyk7XHJcbiAgfVxyXG59KTtcclxuXHJcbiIsIi8qIGxldCBvd2xfY2FyZHMgPSAkKFwiLm93bC1jYXJvdXNlbC0tY2FyZHNcIikub3dsQ2Fyb3VzZWwoe1xyXG4gICAgc2xpZGVTcGVlZDogMzAwLFxyXG4gICAgcGFnaW5hdGlvblNwZWVkOiA0MDAsXHJcbiAgICBpdGVtczogMSxcclxuICAgICAgYXV0b3BsYXk6IDEwMDAsXHJcbiAgICBzdG9wT25Ib3ZlcjogdHJ1ZSxcclxuICAgIGxvb3A6IHRydWUsXHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gbW92ZVRvU2xpZGUoaW5kZXhfc2xpZGUpe1xyXG4gICAgb3dsX2NhcmRzLnRyaWdnZXIoJ3RvLm93bC5jYXJvdXNlbCcsIFtpbmRleF9zbGlkZSwgMTAwMCwgMTAwMF0pO1xyXG5cclxuICAgIGxldCBpdGVtID0gJCgnLm93bC1pdGVtJylbaW5kZXhfc2xpZGUgKyAxXTtcclxuICAgICQoW2RvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgZG9jdW1lbnQuYm9keV0pLmFuaW1hdGUoe1xyXG4gICAgICAgIHNjcm9sbFRvcDogJChpdGVtKS5vZmZzZXQoKS50b3BcclxuICAgIH0sIDUwMCk7XHJcbn1cclxuXHJcbiQoJy5jYXJkcy1uYXZfX25leHQnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgIG93bF9jYXJkcy50cmlnZ2VyKCduZXh0Lm93bC5jYXJvdXNlbCcpO1xyXG59KVxyXG5cclxuJCgnLmNhcmRzLW5hdl9fcHJldicpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgb3dsX2NhcmRzLnRyaWdnZXIoJ3ByZXYub3dsLmNhcm91c2VsJywgWzMwMF0pO1xyXG59KVxyXG4gKi9cclxuXHJcblxyXG5cclxubGV0IG93bF9zZXJ2Y2llcyA9ICQoJy5vd2wtY2Fyb3VzZWwtLXNlcnZpY2VzJykub3dsQ2Fyb3VzZWwoe1xyXG4gICAgc2xpZGVTcGVlZDogMzAwLFxyXG4gICAgcGFnaW5hdGlvblNwZWVkOiA0MDAsXHJcbiAgICBjZW50ZXI6IHRydWUsXHJcbiAgICBzdG9wT25Ib3ZlcjogdHJ1ZSxcclxuICAgIGF1dG9wbGF5OiAxMDAsXHJcbiAgICBsb29wOiB0cnVlLFxyXG4gICAgbWFyZ2luOiA1MCxcclxufSk7XHJcblxyXG5cclxuXHJcblxyXG4kKCcuY2Fyb3VzZWwtc2VydmljZXMtZG90JykuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgb3dsX3NlcnZjaWVzLnRyaWdnZXIoJ3RvLm93bC5jYXJvdXNlbCcsIFskKHRoaXMpLmluZGV4KCksIDMwMF0pO1xyXG4gIH0pO1xyXG5cclxuJCgnLmNhcm91c2VsLXNlcnZpY2VzX19uZXh0JykuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICBvd2xfc2VydmNpZXMudHJpZ2dlcignbmV4dC5vd2wuY2Fyb3VzZWwnLCBbMzAwXSk7XHJcbn0pXHJcblxyXG4kKCcuY2Fyb3VzZWwtc2VydmljZXNfX3ByZXYnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgIG93bF9zZXJ2Y2llcy50cmlnZ2VyKCdwcmV2Lm93bC5jYXJvdXNlbCcsIFszMDBdKTtcclxufSlcclxuXHJcblxyXG5cclxuXHJcbiQoJy5jYXJvdXNlbC1zZXJ2aWNlcy1kb3QnKS5jbGljayhmdW5jdGlvbihpbmRleCwgZG90KXtcclxuICAgIGlmKCQoJy5jYXJvdXNlbC1zZXJ2aWNlcy1kb3RzJykuaGFzQ2xhc3MoJ2ZpeGVkJykpe1xyXG4gICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6ICQoYC5jYXJkX19idG5bZGF0YS1zbGlkZT0nJHskKHRoaXMpLmRhdGEoJ3NsaWRlJyl9J11gKS5wYXJlbnRzKCcuY2FyZCcpLm9mZnNldCgpLnRvcH0sIDEwMDApO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbi8qIG93bF9zZXJ2Y2llcy5vbignY2hhbmdlZC5vd2wuY2Fyb3VzZWwnLCBmdW5jdGlvbihldmVudCl7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+e1xyXG5cclxuXHJcbiAgICAkKCcub3dsLWl0ZW0nKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgbGV0IGN1cnJlbnQgPSAkKHRoaXMpO1xyXG4gICAgICAgIGxldCBjdXJyZW50X2ltZyA9IGN1cnJlbnQuZmluZCgnaW1nJyk7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRfaW1nU3JjID0gY3VycmVudF9pbWcuYXR0cignc3JjJyk7XHJcblxyXG4gICAgICAgIGlmKC9fYWN0aXZlL2cudGVzdChjdXJyZW50X2ltZ1NyYykgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgIGN1cnJlbnRfaW1nLmF0dHIoJ3NyYycsIGN1cnJlbnRfaW1nU3JjLnJlcGxhY2UoL19hY3RpdmUvZywgJycpKTsgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGxldCBjdXJyZW50X3NsaWRlSW5kZXggPSBjdXJyZW50X2ltZy5kYXRhKCdzbGlkZScpO1xyXG4gICAgICAgIGxldCBjdXJyZW50X2RvdCA9ICQoYC5jYXJvdXNlbC1zZXJ2aWNlcy1kb3RbZGF0YS1zbGlkZT1cIiR7Y3VycmVudF9zbGlkZUluZGV4fVwiXWApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGN1cnJlbnRfZG90LmNzcyh7ICd0cmFuc2Zvcm0nOiAncm90YXRlKDApJ30pO1xyXG4gICAgfSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuICAgIGxldCBjZW50ZXJfaXRlbSA9ICQoJy5vd2wtaXRlbS5jZW50ZXInKTtcclxuICAgIGxldCBjZW50ZXJfaXRlbV9faW1nID0gY2VudGVyX2l0ZW0uZmluZCgnaW1nJyk7XHJcbiAgICBsZXQgY2VudGVyX2l0ZW1fX2ltZ1NyYyA9IGNlbnRlcl9pdGVtX19pbWcuYXR0cignc3JjJyk7XHJcbiAgICBjZW50ZXJfaXRlbV9faW1nLmF0dHIoJ3NyYycsIGNlbnRlcl9pdGVtX19pbWdTcmMucmVwbGFjZSgvXFwuL2csJ19hY3RpdmUuJykpO1xyXG5cclxuICAgIGxldCBjZW50ZXJfc2xpZGVJbmRleCA9IGNlbnRlcl9pdGVtX19pbWcuZGF0YSgnc2xpZGUnKTtcclxuICAgIGxldCBjZW50ZXJfZG90ID0gJChgLmNhcm91c2VsLXNlcnZpY2VzLWRvdFtkYXRhLXNsaWRlPVwiJHtjZW50ZXJfc2xpZGVJbmRleH1cIl1gKTtcclxuXHJcbiAgICB2YXIgY2VudGVyX2l0ZW1Sb3RhdGUgPSBNYXRoLnJhbmRvbSgpICogKDI2IC0gLTI2KSArIC0yNjtcclxuICAgIGNlbnRlcl9kb3QuY3NzKHsgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoJyArIGNlbnRlcl9pdGVtUm90YXRlICsgJ2RlZyknfSk7XHJcblxyXG5cclxuXHJcbiAgICBsZXQgY2VudGVyX2NhcmQgPSAkKGAuY2FyZFtkYXRhLXNsaWRlPVwiJHtjZW50ZXJfc2xpZGVJbmRleH1cIl1gKTtcclxuICAgIFxyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6IGNlbnRlcl9jYXJkLm9mZnNldCgpLnRvcH0sIDIwMDApO1xyXG4gICAgfSwgMTAwMCk7XHJcblxyXG4gICAgfSwgNTAwKTtcclxufSk7ICovXHJcbiIsIiQoJy5jYXJkX19idG4nKS5jbGljayhmdW5jdGlvbihlKXtcclxuICAgIGxldCBjYXJkX25hbWUgPSAkKHRoaXMpLnNpYmxpbmdzKCcuY2FyZF9fdGl0bGUnKS50ZXh0KCk7XHJcblxyXG5cclxuICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgc3JjOiAnLnN1Ym1pdC1hcHBsaWNhdGlvbicsXHJcbiAgICAgICAgdHlwZTogJ2lubGluZScsXHJcbi8qICAgICAgICAgaGVpZ2h0OiA4NzAsXHJcbiAgICAgICAgd2lkdGg6IDYwMCwgKi9cclxuICAgICAgICBhdXRvU2l6ZTogdHJ1ZSxcclxuICAgIH0pO1xyXG59KTtcclxuXHJcblxyXG5cclxuXHJcbiQoJy5zdWJtaXQtYXBwbGljYXRpb24tZm9ybScpLnZhbGlkYXRlKHtcclxuICAgIHJ1bGVzOiB7XHJcbiAgICAgICAgcGhvbmU6IHtcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgbmFtZToge1xyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuXHJcbiAgICBtZXNzYWdlczoge1xyXG4gICAgICAgIHBob25lOiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiBcItCS0LLQtdC00LjRgtC1INC90L7QvNC10YAg0YLQtdC70LXRhNC+0L3QsCFcIlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG5hbWU6IHtcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IFwi0JLQstC10LTQuNGC0LUg0LjQvNGPIVwiXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcblxyXG4gICAgICAgIHN1Ym1pdEhhbmRsZXI6IGZ1bmN0aW9uKGZvcm0pIHtcclxuICAgICAgICAgICAgdGhyb3R0bGUoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGxldCBhY3RpdmF0ZWRfaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKCcuYmxvY2suYWN0aXZlIC5ibG9ja19fdGl0bGUnKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZhdGVkX2l0ZW1zLnB1c2goJCh0aGlzKS50ZXh0KCkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcGhwL3N1Ym1pdC1hcHBsaWNhdGlvbi5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwb3N0JyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob25lOiAkKCcuc3VibWl0LWFwcGxpY2F0aW9uLWZvcm0gaW5wdXRbbmFtZT1cInBob25lXCJdJykudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICQoJy5zdWJtaXQtYXBwbGljYXRpb24tZm9ybSBpbnB1dFtuYW1lPVwibmFtZVwiXScpLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXZpZXc6ICQoJy5zdWJtaXQtYXBwbGljYXRpb24tZm9ybSB0ZXh0YXJlYVtuYW1lPVwicmV2aWV3XCInKS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IEpTT04uc3RyaW5naWZ5KGFjdGl2YXRlZF9pdGVtcyksXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEFsZXJ0X3N1Y2MoJ9CX0LDRj9Cy0LrQsCDRg9GB0L/QtdGI0L3QviDQvtGC0L/RgNCw0LLQu9C10L3QsCEg0J7QttC40LTQsNC50YLQtSDQvtGC0LLQtdGC0LAhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sIDE4MDAwMCwgJ3N1Ym1pdC1hcHBsaWNhdGlvbicpKCk7XHJcbiAgICAgICAgfVxyXG59KTtcclxuXHJcblxyXG4kLnZhbGlkYXRvci5hZGRNZXRob2QoXCJwaG9uZVwiLCBmdW5jdGlvbih2YWx1ZSwgZWxlbWVudCkge1xyXG4gICAgcmV0dXJuIHRoaXMub3B0aW9uYWwoZWxlbWVudCkgfHwgL15cXCs/XFxkezEsNH0/Wy0uXFxzXT9cXCg/XFxkezEsM30/XFwpP1stLlxcc10/XFxkezEsNH1bLS5cXHNdP1xcZHsxLDR9Wy0uXFxzXT9cXGR7MSw5fSQvLnRlc3QodmFsdWUpO1xyXG4gICAgfSwgXCLQndC+0LzQtdGAINCy0LLQtdC00LXQvSDQvdC10LrQvtGA0YDQtdC60YLQvdC+IVwiKTsiXX0=
